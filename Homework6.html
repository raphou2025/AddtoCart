<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="bg-gray-100">
    <div class="grid grid-cols-3 p-6 gap-6">
      <!-- LEFT SIDE -->
      <div class="col-span-2">
        <h3 class="text-xl font-bold mb-4">My Small Online Shop</h3>

        <!-- IMPROVED SEARCH BAR -->
        <div class="flex items-center gap-2 mb-4">
          <div class="relative">
            <input
              type="text"
              id="searchBox"
              placeholder="ðŸ” Search for products..."
              class="border px-4 py-2 pr-10 rounded-full w-80 shadow-sm focus:ring-2 focus:ring-blue-400"
              oninput="searchData()"
            />

            <!-- Clear Button -->
            <button
              onclick="clearSearch()"
              id="clearBtn"
              class="absolute right-3 top-2 text-gray-400 hover:text-black text-xl hidden"
            >
              Ã—
            </button>
          </div>

          <button
            id="searchBtn"
            onclick="searchData()"
            class="bg-blue-500 px-5 py-2 rounded-full text-white shadow hover:bg-blue-600"
          >
            Search
          </button>
        </div>

        <!-- PRODUCT LIST -->
        <div class="grid grid-cols-2 gap-4" id="products"></div>
      </div>

      <!-- RIGHT SIDE -->
      <div class="col-span-1 bg-white p-4 rounded-lg shadow">
        <h3 class="text-xl font-bold mb-4">Cart</h3>

        <div id="product-cards" class="space-y-4"></div>

        <div class="mt-6 border-t pt-4">
          <p class="text-lg font-semibold">
            Total: $ <span id="totalAmount">0.00</span>
          </p>
          <button class="bg-green-600 mt-3 px-4 py-2 rounded text-white w-full">
            Checkout
          </button>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      const API_DATA = "https://fakestoreapi.com";

      let cart = [];
      const productList = document.getElementById("products");
      const cartList = document.getElementById("product-cards");
      const totalAmount = document.getElementById("totalAmount");

      // Cart Functions

      function addToCart(product) {
        const existing = cart.find((item) => item.id === product.id);

        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({ ...product, qty: 1 });
        }

        renderCart();
      }

      // Increase and Decrease button FUNCTIONS

      function increaseQty(id) {
        const item = cart.find((c) => c.id === id);
        item.qty++;
        renderCart();
      }

      function decreaseQty(id) {
        const item = cart.find((c) => c.id === id);

        if (item.qty > 1) item.qty--;
        else cart = cart.filter((c) => c.id !== id);

        renderCart();
      }

    //   RenderCart Functions

      function renderCart() {
        cartList.innerHTML = "";
        let total = 0;

        cart.forEach((item) => {
            const itemTotal = item.price * item.qty;
            total += itemTotal;

            const div = document.createElement("div");
            div.className = "flex gap-4 items-center";

            div.innerHTML = `
                <img src = "${item.image}" class="w-16 h-16 object-cover rounded"/>

                <div class="flex-1">
                    <p class="font-semibold">${item.title}</p>
                    <p class="text-sm text-gray-600">$${item.price} x ${item.qty} = 
                        <span class="font-bold">$${itemTotal.toFixed(2)}</span>
                    </p>
                </div>

                <div class="flex gap-2">
                    <button onclick="decreaseQty(${item.id})" 
                      class="bg-red-500 px-3 py-1 rounded text-white">-</button>

                    <button onclick="increaseQty(${item.id})" 
                      class="bg-blue-500 px-3 py-1 rounded text-white">+</button>
                </div>
            `;

            cartList.appendChild(div);
        });
        totalAmount.innerText = total.toFixed(2);
      };

    // Product-Render
    function renderProducts(products) {
        productList.innerHTML = "";

        if (products.length === 0) {
            productList.innerHTML = `
            <p class="text-gray-600 col-span-2 text-center text-lg">No product found.</p>
            `;
            return;
        }

        products.forEach((product) => {
            const div = document.createElement("div");
            div.className = "bg-white rounded p-3 shadow hover:shadow-lg transition";

            div.innerHTML = `
               <img src="${product.image}" class="w-full h-60 object-contain mb-3"/>
               <h1 class="font-semibold text-lg">${product.title}</h1>
               <p class="text-gray-700 mb-2">$${product.price}</p>

               <button class="bg-blue-600 text-white px-3 py-2 rounded w-full">Add to Cart</button>
            `;

            div.querySelector("button").onclick = () => addToCart(product);
            productList.appendChild(div);
        });
    }

    //   Load Product
    
    async function loadProducts() {
        const res = await fetch(`${API_DATA}/products`);
        const data = await res.json();

        window.allProduct = data;
        renderProducts(data);
    }
    loadProducts();

    // Search Function

    function searchData(){
        const text = document.getElementById("searchBox").value.toLowerCase();
        const clearBtn = document.getElementById("clearBtn");

        // show or hide button
        clearBtn.style.display = text.length > 0 ? "block" : "none";

        if (!window.allProduct) return;

        const filtered = window.allProduct.filter((p) => 
           p.title.toLowerCase().includes(text)
        );

        renderProducts(filtered);
    }

    function clearSearch() {
        document.getElementById("searchBox").value = "";
        searchData(); // refresh list
    }
    </script>
  </body>
</html>
